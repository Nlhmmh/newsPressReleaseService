<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.jp.sense.pr.dao.PressReleaseDao">
  <resultMap id="BaseResultMap" type="com.jp.sense.pr.model.entity.PressRelease">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    <id column="ID" jdbcType="INTEGER" property="id" />
    <result column="BUSINESS_ID" jdbcType="INTEGER" property="businessId" />
    <result column="RELEASE_TITLE" jdbcType="VARCHAR" property="releaseTitle" />
    <result column="RELEASE_SUB_TITLE" jdbcType="VARCHAR" property="releaseSubTitle" />
    <result column="RELEASE_LEAD_WORD" jdbcType="VARCHAR" property="releaseLeadWord" />
    <result column="RELEASE_BODY" jdbcType="VARCHAR" property="releaseBody" />
    <result column="MEDIA_ADDITIONAL_INFO" jdbcType="VARCHAR" property="mediaAdditionalInfo" />
    <result column="MEDIA_INFORMATION_TYPE" jdbcType="VARCHAR" property="mediaInformationType" />
    <result column="RELEASE_TYPE" jdbcType="VARCHAR" property="releaseType" />
    <result column="BUSINESS_CATEGORY_ID" jdbcType="INTEGER" property="businessCategoryId" />
    <result column="BUSINESS_SUBCATEGORY_ID" jdbcType="INTEGER" property="businessSubcategoryId" />
    <result column="RELATED_URL" jdbcType="VARCHAR" property="relatedUrl" />
    <result column="MEDIA_LIST_ID" jdbcType="INTEGER" property="mediaListId" />
    <result column="DELIVER_METHOD_MAIL" jdbcType="VARCHAR" property="deliverMethodMail" />
    <result column="DELIVER_METHOD_FAX" jdbcType="VARCHAR" property="deliverMethodFax" />
    <result column="MAIL_TITLE" jdbcType="VARCHAR" property="mailTitle" />
    <result column="MAIL_BODY_LEAD_TEXT" jdbcType="VARCHAR" property="mailBodyLeadText" />
    <result column="DELIVER_MEDIA" jdbcType="VARCHAR" property="deliverMedia" />
    <result column="DELIVER_USER" jdbcType="VARCHAR" property="deliverUser" />
    <result column="PUBLISH_MEDIA" jdbcType="VARCHAR" property="publishMedia" />
    <result column="RELEASE_STATUS" jdbcType="VARCHAR" property="releaseStatus" />
    <result column="PUBLISHED_DATE" jdbcType="TIMESTAMP" property="publishedDate" />
    <result column="DELETE_FLAG" jdbcType="VARCHAR" property="deleteFlag" />
    <result column="CREATE_USER" jdbcType="VARCHAR" property="createUser" />
    <result column="CREATE_DATETIME" jdbcType="TIMESTAMP" property="createDatetime" />
    <result column="UPDATE_USER" jdbcType="VARCHAR" property="updateUser" />
    <result column="UPDATE_DATETIME" jdbcType="TIMESTAMP" property="updateDatetime" />
  </resultMap>
  <sql id="Base_Column_List">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    ID, BUSINESS_ID, RELEASE_TITLE, RELEASE_SUB_TITLE, RELEASE_LEAD_WORD, RELEASE_BODY, 
    MEDIA_ADDITIONAL_INFO, MEDIA_INFORMATION_TYPE, RELEASE_TYPE, BUSINESS_CATEGORY_ID, 
    BUSINESS_SUBCATEGORY_ID, RELATED_URL, MEDIA_LIST_ID, DELIVER_METHOD_MAIL, DELIVER_METHOD_FAX, 
    MAIL_TITLE, MAIL_BODY_LEAD_TEXT, DELIVER_MEDIA, DELIVER_USER, PUBLISH_MEDIA, RELEASE_STATUS, 
    PUBLISHED_DATE, DELETE_FLAG, CREATE_USER, CREATE_DATETIME, UPDATE_USER, UPDATE_DATETIME
  </sql>
  <select id="selectByPrimaryKey" parameterType="java.lang.Integer" resultMap="BaseResultMap">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    select 
    <include refid="Base_Column_List" />
    from press_release
    where ID = #{id,jdbcType=INTEGER}
  </select>
  <delete id="deleteByPrimaryKey" parameterType="java.lang.Integer">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    delete from press_release
    where ID = #{id,jdbcType=INTEGER}
  </delete>
  <insert id="insert" parameterType="com.jp.sense.pr.model.entity.PressRelease">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    <selectKey keyProperty="id" order="AFTER" resultType="java.lang.Integer">
      SELECT LAST_INSERT_ID()
    </selectKey>
    insert into press_release (BUSINESS_ID, RELEASE_TITLE, RELEASE_SUB_TITLE, 
      RELEASE_LEAD_WORD, RELEASE_BODY, MEDIA_ADDITIONAL_INFO, 
      MEDIA_INFORMATION_TYPE, RELEASE_TYPE, BUSINESS_CATEGORY_ID, 
      BUSINESS_SUBCATEGORY_ID, RELATED_URL, MEDIA_LIST_ID, 
      DELIVER_METHOD_MAIL, DELIVER_METHOD_FAX, MAIL_TITLE, 
      MAIL_BODY_LEAD_TEXT, DELIVER_MEDIA, DELIVER_USER, 
      PUBLISH_MEDIA, RELEASE_STATUS, PUBLISHED_DATE, 
      DELETE_FLAG, CREATE_USER, CREATE_DATETIME, 
      UPDATE_USER, UPDATE_DATETIME)
    values (#{businessId,jdbcType=INTEGER}, #{releaseTitle,jdbcType=VARCHAR}, #{releaseSubTitle,jdbcType=VARCHAR}, 
      #{releaseLeadWord,jdbcType=VARCHAR}, #{releaseBody,jdbcType=VARCHAR}, #{mediaAdditionalInfo,jdbcType=VARCHAR}, 
      #{mediaInformationType,jdbcType=VARCHAR}, #{releaseType,jdbcType=VARCHAR}, #{businessCategoryId,jdbcType=INTEGER}, 
      #{businessSubcategoryId,jdbcType=INTEGER}, #{relatedUrl,jdbcType=VARCHAR}, #{mediaListId,jdbcType=INTEGER}, 
      #{deliverMethodMail,jdbcType=VARCHAR}, #{deliverMethodFax,jdbcType=VARCHAR}, #{mailTitle,jdbcType=VARCHAR}, 
      #{mailBodyLeadText,jdbcType=VARCHAR}, #{deliverMedia,jdbcType=VARCHAR}, #{deliverUser,jdbcType=VARCHAR}, 
      #{publishMedia,jdbcType=VARCHAR}, #{releaseStatus,jdbcType=VARCHAR}, #{publishedDate,jdbcType=TIMESTAMP}, 
      #{deleteFlag,jdbcType=VARCHAR}, #{createUser,jdbcType=VARCHAR}, #{createDatetime,jdbcType=TIMESTAMP}, 
      #{updateUser,jdbcType=VARCHAR}, #{updateDatetime,jdbcType=TIMESTAMP})
  </insert>
  <insert id="insertSelective" parameterType="com.jp.sense.pr.model.entity.PressRelease">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    <selectKey keyProperty="id" order="AFTER" resultType="java.lang.Integer">
      SELECT LAST_INSERT_ID()
    </selectKey>
    insert into press_release
    <trim prefix="(" suffix=")" suffixOverrides=",">
      <if test="businessId != null">
        BUSINESS_ID,
      </if>
      <if test="releaseTitle != null">
        RELEASE_TITLE,
      </if>
      <if test="releaseSubTitle != null">
        RELEASE_SUB_TITLE,
      </if>
      <if test="releaseLeadWord != null">
        RELEASE_LEAD_WORD,
      </if>
      <if test="releaseBody != null">
        RELEASE_BODY,
      </if>
      <if test="mediaAdditionalInfo != null">
        MEDIA_ADDITIONAL_INFO,
      </if>
      <if test="mediaInformationType != null">
        MEDIA_INFORMATION_TYPE,
      </if>
      <if test="releaseType != null">
        RELEASE_TYPE,
      </if>
      <if test="businessCategoryId != null">
        BUSINESS_CATEGORY_ID,
      </if>
      <if test="businessSubcategoryId != null">
        BUSINESS_SUBCATEGORY_ID,
      </if>
      <if test="relatedUrl != null">
        RELATED_URL,
      </if>
      <if test="mediaListId != null">
        MEDIA_LIST_ID,
      </if>
      <if test="deliverMethodMail != null">
        DELIVER_METHOD_MAIL,
      </if>
      <if test="deliverMethodFax != null">
        DELIVER_METHOD_FAX,
      </if>
      <if test="mailTitle != null">
        MAIL_TITLE,
      </if>
      <if test="mailBodyLeadText != null">
        MAIL_BODY_LEAD_TEXT,
      </if>
      <if test="deliverMedia != null">
        DELIVER_MEDIA,
      </if>
      <if test="deliverUser != null">
        DELIVER_USER,
      </if>
      <if test="publishMedia != null">
        PUBLISH_MEDIA,
      </if>
      <if test="releaseStatus != null">
        RELEASE_STATUS,
      </if>
      <if test="publishedDate != null">
        PUBLISHED_DATE,
      </if>
      <if test="deleteFlag != null">
        DELETE_FLAG,
      </if>
      <if test="createUser != null">
        CREATE_USER,
      </if>
      <if test="createDatetime != null">
        CREATE_DATETIME,
      </if>
      <if test="updateUser != null">
        UPDATE_USER,
      </if>
      <if test="updateDatetime != null">
        UPDATE_DATETIME,
      </if>
    </trim>
    <trim prefix="values (" suffix=")" suffixOverrides=",">
      <if test="businessId != null">
        #{businessId,jdbcType=INTEGER},
      </if>
      <if test="releaseTitle != null">
        #{releaseTitle,jdbcType=VARCHAR},
      </if>
      <if test="releaseSubTitle != null">
        #{releaseSubTitle,jdbcType=VARCHAR},
      </if>
      <if test="releaseLeadWord != null">
        #{releaseLeadWord,jdbcType=VARCHAR},
      </if>
      <if test="releaseBody != null">
        #{releaseBody,jdbcType=VARCHAR},
      </if>
      <if test="mediaAdditionalInfo != null">
        #{mediaAdditionalInfo,jdbcType=VARCHAR},
      </if>
      <if test="mediaInformationType != null">
        #{mediaInformationType,jdbcType=VARCHAR},
      </if>
      <if test="releaseType != null">
        #{releaseType,jdbcType=VARCHAR},
      </if>
      <if test="businessCategoryId != null">
        #{businessCategoryId,jdbcType=INTEGER},
      </if>
      <if test="businessSubcategoryId != null">
        #{businessSubcategoryId,jdbcType=INTEGER},
      </if>
      <if test="relatedUrl != null">
        #{relatedUrl,jdbcType=VARCHAR},
      </if>
      <if test="mediaListId != null">
        #{mediaListId,jdbcType=INTEGER},
      </if>
      <if test="deliverMethodMail != null">
        #{deliverMethodMail,jdbcType=VARCHAR},
      </if>
      <if test="deliverMethodFax != null">
        #{deliverMethodFax,jdbcType=VARCHAR},
      </if>
      <if test="mailTitle != null">
        #{mailTitle,jdbcType=VARCHAR},
      </if>
      <if test="mailBodyLeadText != null">
        #{mailBodyLeadText,jdbcType=VARCHAR},
      </if>
      <if test="deliverMedia != null">
        #{deliverMedia,jdbcType=VARCHAR},
      </if>
      <if test="deliverUser != null">
        #{deliverUser,jdbcType=VARCHAR},
      </if>
      <if test="publishMedia != null">
        #{publishMedia,jdbcType=VARCHAR},
      </if>
      <if test="releaseStatus != null">
        #{releaseStatus,jdbcType=VARCHAR},
      </if>
      <if test="publishedDate != null">
        #{publishedDate,jdbcType=TIMESTAMP},
      </if>
      <if test="deleteFlag != null">
        #{deleteFlag,jdbcType=VARCHAR},
      </if>
      <if test="createUser != null">
        #{createUser,jdbcType=VARCHAR},
      </if>
      <if test="createDatetime != null">
        #{createDatetime,jdbcType=TIMESTAMP},
      </if>
      <if test="updateUser != null">
        #{updateUser,jdbcType=VARCHAR},
      </if>
      <if test="updateDatetime != null">
        #{updateDatetime,jdbcType=TIMESTAMP},
      </if>
    </trim>
  </insert>
  <update id="updateByPrimaryKeySelective" parameterType="com.jp.sense.pr.model.entity.PressRelease">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    update press_release
    <set>
      <if test="businessId != null">
        BUSINESS_ID = #{businessId,jdbcType=INTEGER},
      </if>
      <if test="releaseTitle != null">
        RELEASE_TITLE = #{releaseTitle,jdbcType=VARCHAR},
      </if>
      <if test="releaseSubTitle != null">
        RELEASE_SUB_TITLE = #{releaseSubTitle,jdbcType=VARCHAR},
      </if>
      <if test="releaseLeadWord != null">
        RELEASE_LEAD_WORD = #{releaseLeadWord,jdbcType=VARCHAR},
      </if>
      <if test="releaseBody != null">
        RELEASE_BODY = #{releaseBody,jdbcType=VARCHAR},
      </if>
      <if test="mediaAdditionalInfo != null">
        MEDIA_ADDITIONAL_INFO = #{mediaAdditionalInfo,jdbcType=VARCHAR},
      </if>
      <if test="mediaInformationType != null">
        MEDIA_INFORMATION_TYPE = #{mediaInformationType,jdbcType=VARCHAR},
      </if>
      <if test="releaseType != null">
        RELEASE_TYPE = #{releaseType,jdbcType=VARCHAR},
      </if>
      <if test="businessCategoryId != null">
        BUSINESS_CATEGORY_ID = #{businessCategoryId,jdbcType=INTEGER},
      </if>
      <if test="businessSubcategoryId != null">
        BUSINESS_SUBCATEGORY_ID = #{businessSubcategoryId,jdbcType=INTEGER},
      </if>
      <if test="relatedUrl != null">
        RELATED_URL = #{relatedUrl,jdbcType=VARCHAR},
      </if>
      <if test="mediaListId != null">
        MEDIA_LIST_ID = #{mediaListId,jdbcType=INTEGER},
      </if>
      <if test="deliverMethodMail != null">
        DELIVER_METHOD_MAIL = #{deliverMethodMail,jdbcType=VARCHAR},
      </if>
      <if test="deliverMethodFax != null">
        DELIVER_METHOD_FAX = #{deliverMethodFax,jdbcType=VARCHAR},
      </if>
      <if test="mailTitle != null">
        MAIL_TITLE = #{mailTitle,jdbcType=VARCHAR},
      </if>
      <if test="mailBodyLeadText != null">
        MAIL_BODY_LEAD_TEXT = #{mailBodyLeadText,jdbcType=VARCHAR},
      </if>
      <if test="deliverMedia != null">
        DELIVER_MEDIA = #{deliverMedia,jdbcType=VARCHAR},
      </if>
      <if test="deliverUser != null">
        DELIVER_USER = #{deliverUser,jdbcType=VARCHAR},
      </if>
      <if test="publishMedia != null">
        PUBLISH_MEDIA = #{publishMedia,jdbcType=VARCHAR},
      </if>
      <if test="releaseStatus != null">
        RELEASE_STATUS = #{releaseStatus,jdbcType=VARCHAR},
      </if>
      <if test="publishedDate != null">
        PUBLISHED_DATE = #{publishedDate,jdbcType=TIMESTAMP},
      </if>
      <if test="deleteFlag != null">
        DELETE_FLAG = #{deleteFlag,jdbcType=VARCHAR},
      </if>
      <if test="createUser != null">
        CREATE_USER = #{createUser,jdbcType=VARCHAR},
      </if>
      <if test="createDatetime != null">
        CREATE_DATETIME = #{createDatetime,jdbcType=TIMESTAMP},
      </if>
      <if test="updateUser != null">
        UPDATE_USER = #{updateUser,jdbcType=VARCHAR},
      </if>
      <if test="updateDatetime != null">
        UPDATE_DATETIME = #{updateDatetime,jdbcType=TIMESTAMP},
      </if>
    </set>
    where ID = #{id,jdbcType=INTEGER}
  </update>
  <update id="updateByPrimaryKey" parameterType="com.jp.sense.pr.model.entity.PressRelease">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    update press_release
    set BUSINESS_ID = #{businessId,jdbcType=INTEGER},
      RELEASE_TITLE = #{releaseTitle,jdbcType=VARCHAR},
      RELEASE_SUB_TITLE = #{releaseSubTitle,jdbcType=VARCHAR},
      RELEASE_LEAD_WORD = #{releaseLeadWord,jdbcType=VARCHAR},
      RELEASE_BODY = #{releaseBody,jdbcType=VARCHAR},
      MEDIA_ADDITIONAL_INFO = #{mediaAdditionalInfo,jdbcType=VARCHAR},
      MEDIA_INFORMATION_TYPE = #{mediaInformationType,jdbcType=VARCHAR},
      RELEASE_TYPE = #{releaseType,jdbcType=VARCHAR},
      BUSINESS_CATEGORY_ID = #{businessCategoryId,jdbcType=INTEGER},
      BUSINESS_SUBCATEGORY_ID = #{businessSubcategoryId,jdbcType=INTEGER},
      RELATED_URL = #{relatedUrl,jdbcType=VARCHAR},
      MEDIA_LIST_ID = #{mediaListId,jdbcType=INTEGER},
      DELIVER_METHOD_MAIL = #{deliverMethodMail,jdbcType=VARCHAR},
      DELIVER_METHOD_FAX = #{deliverMethodFax,jdbcType=VARCHAR},
      MAIL_TITLE = #{mailTitle,jdbcType=VARCHAR},
      MAIL_BODY_LEAD_TEXT = #{mailBodyLeadText,jdbcType=VARCHAR},
      DELIVER_MEDIA = #{deliverMedia,jdbcType=VARCHAR},
      DELIVER_USER = #{deliverUser,jdbcType=VARCHAR},
      PUBLISH_MEDIA = #{publishMedia,jdbcType=VARCHAR},
      RELEASE_STATUS = #{releaseStatus,jdbcType=VARCHAR},
      PUBLISHED_DATE = #{publishedDate,jdbcType=TIMESTAMP},
      DELETE_FLAG = #{deleteFlag,jdbcType=VARCHAR},
      CREATE_USER = #{createUser,jdbcType=VARCHAR},
      CREATE_DATETIME = #{createDatetime,jdbcType=TIMESTAMP},
      UPDATE_USER = #{updateUser,jdbcType=VARCHAR},
      UPDATE_DATETIME = #{updateDatetime,jdbcType=TIMESTAMP}
    where ID = #{id,jdbcType=INTEGER}
  </update>
  
  <!-- =============================================================================================== -->
  
  <!-- == -->
  <!-- =Nay= -->
  <select id="selectAll" resultMap="BaseResultMap">
    select  
    <include refid="Base_Column_List" />
    FROM press_release
  </select>
  <!-- == -->
  
  <!-- == -->
  <!-- =Nay= -->
  <resultMap id="PressReleaseNewMap" type="com.jp.sense.pr.model.dto.PressReleaseNewDTO">
    <id column="pr_ID" jdbcType="INTEGER" property="id" />
    <result column="pr_image" jdbcType="VARCHAR" property="prImage" />
    <result column="pr_title" jdbcType="VARCHAR" property="prTitle" />
    <result column="pr_date" jdbcType="TIMESTAMP" property="prDate" />
    <result column="business_name" jdbcType="VARCHAR" property="companyName" />
    <result column="pv" jdbcType="VARCHAR" property="pv" />
    <result column="uu" jdbcType="VARCHAR" property="uu" />
  </resultMap>
  
  <!-- == -->
  <!-- =Nay= -->
  <resultMap id="ReportDataOverallMap" type="com.jp.sense.pr.model.dto.ReportDataOverallDTO">
    <id column="compId" jdbcType="INTEGER" property="compId" />
    <result column="pv" jdbcType="INTEGER" property="pv_overall" />
    <result column="uu" jdbcType="INTEGER" property="uu_overall" />
    <result column="reprint_sites" jdbcType="INTEGER" property="reprint_sites_overall" />
  </resultMap>
  
  <!-- == -->
  <!-- =Nay= -->
  <resultMap id="ReportDataGraphMap" type="com.jp.sense.pr.model.dto.ReportDataGraphDTO">
    <result column="acc_time" jdbcType="DATE" property="accessTime" />
    <result column="pv" jdbcType="INTEGER" property="pv" />
    <result column="uu" jdbcType="INTEGER" property="uu" />
  </resultMap>
  
  <!-- == -->
  <!-- =Nay= -->
  <resultMap id="ReportDataMap" type="com.jp.sense.pr.model.dto.ReportDataDTO">
    <result column="overallCount" jdbcType="INTEGER" property="overallCount" />
    <result column="pr_title" jdbcType="VARCHAR" property="title" />
    <result column="pr_published_date" jdbcType="DATE" property="pr_published_date" />
    <result column="pr_ID" jdbcType="INTEGER" property="pr_ID" />
    <result column="access_pc" jdbcType="INTEGER" property="access_pc" />
    <result column="access_phone" jdbcType="INTEGER" property="access_phone" />
    <result column="access_tablet" jdbcType="INTEGER" property="access_tablet" />
    <result column="reprint_sites" jdbcType="INTEGER" property="reprint_sites" />
    <result column="pv" jdbcType="INTEGER" property="pv" />
    <result column="uu" jdbcType="INTEGER" property="uu" />
  </resultMap>
  
  <!-- == -->
  <!-- =Nay= -->
  <select id="selectPRListNew" resultMap="PressReleaseNewMap">
    select
    	pr.id AS pr_ID,
    	(															
			SELECT image_name														
			FROM press_release_image														
			WHERE 														
				press_release_id = pr_ID AND 													
				delete_flag = '0'													
			LIMIT 1														
		) AS pr_image,															
    	pr.release_title as pr_title,
    	pr.published_date as pr_date,
    	c.corporate_name as business_name
    FROM
    	press_release pr
    	LEFT JOIN company c ON c.id = pr.business_id
    WHERE
    	pr.delete_flag = '0' AND
    	c.delete_flag = '0' AND
    	pr.release_status = '2'
    ORDER BY
    	pr_date ASC
    LIMIT 0, 12
  </select>
  <!-- == -->
  
  <!-- == -->
  <!-- =Nay= -->
  <select id="selectPRListImaWadai" parameterType="java.lang.Integer" resultMap="PressReleaseNewMap">
    select
    	pr.id AS pr_ID,
    	(															
			SELECT image_name														
			FROM press_release_image														
			WHERE 														
				press_release_id = pr_ID AND 													
				delete_flag = '0'													
			LIMIT 1														
		) AS pr_image,															
    	pr.release_title as pr_title,
    	pr.published_date as pr_date,
    	c.corporate_name as business_name,
    	( 															
		    SELECT															
		        COUNT(1) 															
		    FROM															
		        press_release pr															
		        LEFT JOIN press_release_access_history prHistory 															
		            ON pr.id = prHistory.press_release_id															
		    WHERE															
			pr.id = pr_ID AND														
			pr.delete_flag = '0' AND														
			prHistory.delete_flag = '0'														
		) as pv,															
		( 															
		    SELECT															
		        COUNT(DISTINCT prHistory.access_ip) 															
		    FROM															
		        press_release pr															
		        LEFT JOIN press_release_access_history prHistory 															
		            ON pr.id = prHistory.press_release_id															
		    WHERE															
			pr.id = pr_ID AND														
			pr.delete_flag = '0' AND														
			prHistory.delete_flag = '0'														
		) as uu															
    FROM
    	press_release pr
    	LEFT JOIN company c ON c.id = pr.business_id
    WHERE
    	DATE(pr.published_date) BETWEEN CURDATE() - INTERVAL 7 DAY AND CURDATE() AND
    	pr.delete_flag = '0' AND
    	c.delete_flag = '0' AND
    	pr.release_status = '2'
    ORDER BY
    	pv DESC
    LIMIT 0, #{count,jdbcType=INTEGER}
  </select>
  <!-- == -->
  
  <!-- == -->
  <!-- =Nay= -->
  <select id="selectPRListKyou" parameterType="java.lang.Integer" resultMap="PressReleaseNewMap">
    select
    	pr.id AS pr_ID,
    	(															
			SELECT image_name														
			FROM press_release_image														
			WHERE 														
				press_release_id = pr_ID AND 													
				delete_flag = '0'													
			LIMIT 1														
		) AS pr_image,															
    	pr.release_title as pr_title,
    	pr.published_date as pr_date,
    	c.corporate_name as business_name,
    	( 															
		    SELECT															
		        COUNT(1) 															
		    FROM															
		        press_release pr															
		        LEFT JOIN press_release_access_history prHistory 															
		            ON pr.id = prHistory.press_release_id															
		    WHERE															
			pr.id = pr_ID AND														
			pr.delete_flag = '0' AND														
			prHistory.delete_flag = '0'														
		) as pv,															
		( 															
		    SELECT															
		        COUNT(DISTINCT prHistory.access_ip) 															
		    FROM															
		        press_release pr															
		        LEFT JOIN press_release_access_history prHistory 															
		            ON pr.id = prHistory.press_release_id															
		    WHERE															
			pr.id = pr_ID AND														
			pr.delete_flag = '0' AND														
			prHistory.delete_flag = '0'														
		) as uu															
    FROM
    	press_release pr
    	LEFT JOIN company c ON c.id = pr.business_id
    WHERE
    	DATE(pr.published_date) &lt; CURDATE() AND
    	pr.delete_flag = '0' AND
    	c.delete_flag = '0' AND
    	pr.release_status = '2'
    ORDER BY
    	pv DESC
    LIMIT 0, #{count,jdbcType=INTEGER}
  </select>
  <!-- == -->
  
  <!-- == -->
  <!-- =Nay= -->
  <select id="selectPRListKonShuu" parameterType="java.lang.Integer" resultMap="PressReleaseNewMap">
    select
    	pr.id AS pr_ID,
    	(															
			SELECT image_name														
			FROM press_release_image														
			WHERE 														
				press_release_id = pr_ID AND 													
				delete_flag = '0'													
			LIMIT 1														
		) AS pr_image,															
    	pr.release_title as pr_title,
    	pr.published_date as pr_date,
    	c.corporate_name as business_name,
    	( 															
		    SELECT															
		        COUNT(1) 															
		    FROM															
		        press_release pr															
		        LEFT JOIN press_release_access_history prHistory 															
		            ON pr.id = prHistory.press_release_id															
		    WHERE															
			pr.id = pr_ID AND														
			pr.delete_flag = '0' AND														
			prHistory.delete_flag = '0'														
		) as pv,															
		( 															
		    SELECT															
		        COUNT(DISTINCT prHistory.access_ip) 															
		    FROM															
		        press_release pr															
		        LEFT JOIN press_release_access_history prHistory 															
		            ON pr.id = prHistory.press_release_id															
		    WHERE															
			pr.id = pr_ID AND														
			pr.delete_flag = '0' AND														
			prHistory.delete_flag = '0'														
		) as uu															
    FROM
    	press_release pr
    	LEFT JOIN company c ON c.id = pr.business_id
    WHERE
    	DATE(pr.published_date) BETWEEN CURDATE() - INTERVAL 7 DAY AND CURDATE() AND
    	pr.delete_flag = '0' AND
    	c.delete_flag = '0' AND
    	pr.release_status = '2'
    ORDER BY
    	pv DESC
    LIMIT 0, #{count,jdbcType=INTEGER}
  </select>
  <!-- == -->
  
  <!-- == -->
  <!-- =Nay= -->
  <select id="selectPRListKonGatsu" parameterType="java.lang.Integer" resultMap="PressReleaseNewMap">
    select
    	pr.id AS pr_ID,
    	(															
			SELECT image_name														
			FROM press_release_image														
			WHERE 														
				press_release_id = pr_ID AND 													
				delete_flag = '0'													
			LIMIT 1														
		) AS pr_image,															
    	pr.release_title as pr_title,
    	pr.published_date as pr_date,
    	c.corporate_name as business_name,
    	( 															
		    SELECT															
		        COUNT(1) 															
		    FROM															
		        press_release pr															
		        LEFT JOIN press_release_access_history prHistory 															
		            ON pr.id = prHistory.press_release_id															
		    WHERE															
			pr.id = pr_ID AND														
			pr.delete_flag = '0' AND														
			prHistory.delete_flag = '0'														
		) as pv,															
		( 															
		    SELECT															
		        COUNT(DISTINCT prHistory.access_ip) 															
		    FROM															
		        press_release pr															
		        LEFT JOIN press_release_access_history prHistory 															
		            ON pr.id = prHistory.press_release_id															
		    WHERE															
			pr.id = pr_ID AND														
			pr.delete_flag = '0' AND														
			prHistory.delete_flag = '0'														
		) as uu															
    FROM
    	press_release pr
    	LEFT JOIN company c ON c.id = pr.business_id
    WHERE
    	DATE(pr.published_date) BETWEEN CURDATE() - INTERVAL 30 DAY AND CURDATE() AND
    	pr.delete_flag = '0' AND
    	c.delete_flag = '0' AND
    	pr.release_status = '2'
    ORDER BY
    	pv DESC
    LIMIT 0, #{count,jdbcType=INTEGER}
  </select>
  <!-- == -->
  
  <!-- == -->
  <!-- =Nay= -->
  <select id="selectReportDataOverall" parameterType="java.lang.Integer" resultMap="ReportDataOverallMap">
    SELECT 
	    c.id AS com_id,
	    (SELECT 
	            COUNT(1)
	        FROM
	            press_release pr
				LEFT JOIN press_release_access_history prHistory ON pr.id = prHistory.press_release_id
	        WHERE
	            pr.id IN (
					SELECT id
	                FROM press_release
	                WHERE
	                    business_id = com_id AND
						delete_flag = '0'
				) AND
				pr.delete_flag = '0' AND
				prHistory.delete_flag = '0'
		) AS pv,
	    (SELECT 
	            COUNT(DISTINCT prHistory.access_ip)
	        FROM
	            press_release pr
				LEFT JOIN press_release_access_history prHistory ON pr.id = prHistory.press_release_id
	        WHERE
	            pr.id IN (
					SELECT id
	                FROM press_release
	                WHERE 
						business_id = com_id AND
						delete_flag = '0'
				) AND
				pr.delete_flag = '0' AND
				prHistory.delete_flag = '0'
		) AS uu,
	    (SELECT 
				COUNT(1)
			FROM
				image_reprint_analysis_info imgRAI
				LEFT JOIN press_release_image pri ON pri.image_name = imgRAI.image_name
			WHERE
				pri.id IN (
					SELECT 
						id
					FROM
						press_release_image
					WHERE
						PRESS_RELEASE_ID in (
							SELECT id 
							FROM press_release 
							WHERE 
								business_id = com_id
								AND delete_flag = '0'
							)
						AND delete_flag = '0'
				)
				AND imgRAI.delete_flag = '0'
				AND pri.delete_flag = '0'
		) AS reprint_sites
	FROM
	    press_release pr
		LEFT JOIN company c ON c.id = pr.business_id
	WHERE
	    c.id = #{compId,jdbcType=INTEGER} AND 
	    pr.delete_flag = '0' AND 
	    c.delete_flag = '0'
	LIMIT 1;
  </select>
  <!-- == -->	
  
  <!-- == -->
  <!-- =Nay= --> 
  <select id="selectReportData" resultMap="ReportDataMap"> 
  SELECT
    (	
		SELECT	
			COUNT(1)	
		FROM
			press_release pr
		WHERE
			pr.business_id = #{compId} AND
			pr.delete_flag = '0' AND	
			pr.release_status = '2'
	) AS overallCount,
	pr.release_title AS pr_title,
	pr.published_date AS pr_published_date,
	pr.id AS pr_ID,
	(
		SELECT
			COUNT(1)
		FROM
			press_release_access_history prHistory
			LEFT JOIN press_release pr	ON pr.id = prHistory.press_release_id
		WHERE
			prHistory.reader_type = '1' AND
			pr.id = pr_ID AND
			pr.delete_flag = '0' AND
			prHistory.delete_flag = '0'
	) AS access_pc,
	(
		SELECT	
			COUNT(1)
		FROM
			press_release pr
			LEFT JOIN press_release_access_history prHistory
				ON pr.id = prHistory.press_release_id
		WHERE
            prHistory.reader_type = '2' AND
			pr.id = pr_ID AND
			pr.delete_flag = '0' AND
            prHistory.delete_flag = '0'
	) AS access_phone,
	(
		SELECT																
			COUNT(1) 																
		FROM																
			press_release pr																
			LEFT JOIN press_release_access_history prHistory ON pr.id = prHistory.press_release_id
		WHERE					
            prHistory.reader_type = '3' AND															
			pr.id = pr_ID AND															
			pr.delete_flag = '0' AND															
			prHistory.delete_flag = '0'															
	) AS access_tablet,																
	( 																
		SELECT															
			COUNT(1) 														
		FROM															
			image_reprint_analysis_info imgRAI														
			LEFT JOIN press_release_image pri ON pri.image_name = imgRAI.image_name													
		WHERE															
			pri.press_release_id = pr_id  AND														
			pr.delete_flag = '0' AND														
			pri.delete_flag = '0'														
	) AS reprint_sites,																
	( 																
		SELECT																
			COUNT(1) 																
		FROM																
			press_release pr																
			LEFT JOIN press_release_access_history prHistory ON pr.id = prHistory.press_release_id																
		WHERE																
		pr.id = pr_ID AND															
		pr.delete_flag = '0' AND															
		prHistory.delete_flag = '0'															
	) AS pv,															
	( 																
		SELECT																
			COUNT(DISTINCT prHistory.access_ip) 																
		FROM																
			press_release pr																
			LEFT JOIN press_release_access_history prHistory ON pr.id = prHistory.press_release_id																
		WHERE																
		pr.id = pr_ID AND															
		pr.delete_flag = '0' AND															
		prHistory.delete_flag = '0'															
	) AS uu			
	FROM 
		press_release pr																					
	WHERE 
		pr.business_id = #{compId} AND																												
		pr.delete_flag = '0' AND																												
		pr.release_status = '2'																												
	ORDER BY pr_published_date DESC																												
	LIMIT #{pageStartCount}, #{pageCount};
  </select>
  <!-- == -->		
  
  <!-- == -->
  <!-- =Nay= --> 
  <select id="selectReportDataGraphDay" resultMap="ReportDataGraphMap"> 
  	SELECT
	DISTINCT 
	prHistory.access_time as acc_time,
	c.id as com_id,															
	( 																
		SELECT																
			COUNT(1) 																
		FROM																
			press_release pr																
			LEFT JOIN press_release_access_history prHistory ON pr.id = prHistory.press_release_id																
		WHERE															
			prHistory.access_time = acc_time AND															
			pr.delete_flag = '0' AND															
			prHistory.delete_flag = '0'														
	) AS pv,															
	( 																
		SELECT																
			COUNT(DISTINCT prHistory.access_ip) 																
		FROM																
			press_release pr																
			LEFT JOIN press_release_access_history prHistory ON pr.id = prHistory.press_release_id																
		WHERE															
			prHistory.access_time = acc_time AND															
			pr.delete_flag = '0' AND															
			prHistory.delete_flag = '0'															
	) AS uu
	FROM 
		press_release pr
		LEFT JOIN press_release_access_history prHistory ON prHistory.press_release_id = pr.id
		LEFT JOIN company c ON c.id = pr.business_id																					
	WHERE 
    	DATE(prHistory.access_time) BETWEEN CURDATE() - INTERVAL 30 DAY AND CURDATE() AND
    	c.id = #{compId} AND																												
		pr.delete_flag = '0' AND
		prHistory.delete_flag = '0' AND
		c.delete_flag = '0'																												
	ORDER BY acc_time DESC
  </select>
  <!-- == -->		
  
  <!-- == -->
  <!-- =Nay= --> 
  <select id="selectReportDataGraphWeek" resultMap="ReportDataGraphMap"> 
  	SELECT
    DATE(DATE_ADD(DATE_ADD(prHistory.access_time, INTERVAL -WEEKDAY(prHistory.access_time) - 1 day), INTERVAL 2 day)) as acc_time,
	c.id as com_id,															
	( 																
		SELECT																
			COUNT(1) 																
		FROM																
			press_release pr																
			LEFT JOIN press_release_access_history prHistory ON pr.id = prHistory.press_release_id																
		WHERE
			DATE(prHistory.access_time) BETWEEN acc_time AND acc_time + INTERVAL 1 WEEK - INTERVAL 1 DAY AND															
			pr.delete_flag = '0' AND															
			prHistory.delete_flag = '0'														
	) AS pv,															
	( 																
		SELECT																
			COUNT(DISTINCT prHistory.access_ip) 																
		FROM																
			press_release pr																
			LEFT JOIN press_release_access_history prHistory ON pr.id = prHistory.press_release_id																
		WHERE
			DATE(prHistory.access_time) BETWEEN acc_time AND acc_time + INTERVAL 1 WEEK - INTERVAL 1 DAY AND													
			pr.delete_flag = '0' AND															
			prHistory.delete_flag = '0'															
	) AS uu
	FROM 
		press_release pr
		LEFT JOIN press_release_access_history prHistory ON prHistory.press_release_id = pr.id
		LEFT JOIN company c ON c.id = pr.business_id																					
	WHERE
    	DATE(prHistory.access_time) BETWEEN CURDATE() - INTERVAL 1 YEAR AND CURDATE() AND
    	c.id = #{compId} AND																												
		pr.delete_flag = '0' AND
		prHistory.delete_flag = '0' AND
		c.delete_flag = '0'
	GROUP BY WEEK(acc_time)
	ORDER BY acc_time DESC
  </select>
  <!-- == -->		
  
  <!-- == -->
  <!-- =Nay= --> 
  <select id="selectReportDataGraphMonth" resultMap="ReportDataGraphMap"> 
  SELECT
	DATE_ADD(DATE_ADD(LAST_DAY(prHistory.access_time), INTERVAL 1 DAY), INTERVAL -1 MONTH) as acc_time,
	c.id as com_id,															
	( 																
		SELECT																
			COUNT(1) 																
		FROM																
			press_release pr																
			LEFT JOIN press_release_access_history prHistory ON pr.id = prHistory.press_release_id																
		WHERE
			DATE(prHistory.access_time) BETWEEN acc_time AND acc_time + INTERVAL 1 MONTH - INTERVAL 1 DAY AND	
			pr.delete_flag = '0' AND															
			prHistory.delete_flag = '0'														
	) AS pv,															
	( 																
		SELECT																
			COUNT(DISTINCT prHistory.access_ip) 																
		FROM																
			press_release pr																
			LEFT JOIN press_release_access_history prHistory ON pr.id = prHistory.press_release_id																
		WHERE
			DATE(prHistory.access_time) BETWEEN acc_time AND acc_time + INTERVAL 1 MONTH - INTERVAL 1 DAY AND														
			pr.delete_flag = '0' AND															
			prHistory.delete_flag = '0'															
	) AS uu
	FROM 
		press_release pr
		LEFT JOIN press_release_access_history prHistory ON prHistory.press_release_id = pr.id
		LEFT JOIN company c ON c.id = pr.business_id																					
	WHERE
    	DATE(prHistory.access_time) BETWEEN CURDATE() - INTERVAL 1 YEAR AND CURDATE() AND
    	c.id = #{compId} AND																												
		pr.delete_flag = '0' AND
		prHistory.delete_flag = '0' AND
		c.delete_flag = '0'
	GROUP BY MONTH(acc_time)
	ORDER BY acc_time DESC
  </select>
  <!-- == -->

  <!-- pr-home-1017 プレスリリース画像取得 -->
  <select id="selectPrImage" parameterType="java.lang.Integer" resultType="com.jp.sense.pr.model.dto.PressReleaseListDTO">
  SELECT 
    pri.image_name AS prImage,
    pr.business_id AS prBId
  FROM 
    press_release pr 
  LEFT JOIN press_release_image pri ON pr.id = pri.press_release_id 
  WHERE 
    pr.business_id= #{id,jdbcType=INTEGER} AND 
    pr.delete_flag = '0' AND 
    pr.release_status = '2' AND 
    pr.published_date <![CDATA[ < ]]> now() 
  ORDER BY 
    pr.create_datetime DESC 
  LIMIT 0, 5  
  </select>
  
  <!-- pr-home-1017 プレスリリース一覧取得 -->
  <select id="selectPrList" parameterType="java.lang.Integer" resultType="com.jp.sense.pr.model.dto.PressReleaseListDTO">
    SELECT 
    pr.id AS prId,
    pri.image_name AS prImage,
    pr.release_title AS prTitle,
    pr.create_datetime AS prCreateDateTime,
    com.corporate_name AS CompCorporateName
  FROM 
    press_release pr 
  LEFT JOIN press_release_image pri ON pr.id = pri.press_release_id
  LEFT JOIN company com ON pr.business_id=com.id 
  WHERE 
    pr.business_id= #{id,jdbcType=INTEGER} AND 
    pr.delete_flag = '0' AND 
    pr.release_status = '2' AND 
    pr.published_date <![CDATA[ < ]]> now() 
  ORDER BY 
    pr.create_datetime DESC 
  LIMIT 0, 15  
  </select>
  
  <!-- pr-home-1017 検索ボタン押下 -->
  <select id="pushKensakuBtn" resultType="com.jp.sense.pr.model.dto.PressReleaseListDTO">
    SELECT 
    pr.id AS prId,
    pri.image_name AS prImage,
    pr.release_title AS prTitle,
    pr.create_datetime AS prCreateDateTime,
    com.corporate_name AS CompCorporateName
  FROM 
    press_release pr 
  LEFT JOIN press_release_image pri ON pr.id = pri.press_release_id
  LEFT JOIN company com ON pr.business_id=com.id 
  WHERE 
    pr.delete_flag = '0' AND 
    (release_title LIKE CONCAT('%',#{param1,jdbcType=VARCHAR},'%') OR release_sub_title LIKE CONCAT('%',#{param1,jdbcType=VARCHAR},'%')) AND 
    com.id = #{param2,jdbcType=INTEGER}
  </select>
  
  <!-- pr-home-1017 もっと見るボタン押下 -->
  <select id="selectPrListMore" parameterType="java.lang.Integer" resultType="com.jp.sense.pr.model.dto.PressReleaseListDTO">
    SELECT 
    pr.id AS prId,
    pri.image_name AS prImage,
    pr.release_title AS prTitle,
    pr.create_datetime AS prCreateDateTime,
    com.corporate_name AS CompCorporateName
  FROM 
    press_release pr 
  LEFT JOIN press_release_image pri ON pr.id = pri.press_release_id
  LEFT JOIN company com ON pr.business_id=com.id 
  WHERE 
    pr.business_id= #{businessId,jdbcType=INTEGER} AND 
    pr.delete_flag = '0' AND 
    pr.release_status = '2' AND 
    pr.published_date <![CDATA[ < ]]> now() 
  ORDER BY 
    pr.create_datetime DESC  
  LIMIT #{count,jdbcType=INTEGER}, 15
  </select>  
  
</mapper>