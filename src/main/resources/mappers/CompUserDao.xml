<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.jp.sense.pr.dao.CompUserDao">
  <resultMap id="BaseResultMap" type="com.jp.sense.pr.model.entity.CompUser">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    <id column="user_id" jdbcType="INTEGER" property="userId" />
    <result column="company_id" jdbcType="INTEGER" property="companyId" />
    <result column="with_authority" jdbcType="VARCHAR" property="withAuthority" />
    <result column="email" jdbcType="VARCHAR" property="email" />
    <result column="password" jdbcType="VARCHAR" property="password" />
    <result column="name" jdbcType="VARCHAR" property="name" />
    <result column="name_kana" jdbcType="VARCHAR" property="nameKana" />
    <result column="department" jdbcType="VARCHAR" property="department" />
    <result column="phone_no" jdbcType="VARCHAR" property="phoneNo" />
    <result column="fax" jdbcType="VARCHAR" property="fax" />
    <result column="delete_flag" jdbcType="VARCHAR" property="deleteFlag" />
    <result column="create_user" jdbcType="VARCHAR" property="createUser" />
    <result column="create_datetime" jdbcType="TIMESTAMP" property="createDatetime" />
    <result column="update_user" jdbcType="VARCHAR" property="updateUser" />
    <result column="update_datetime" jdbcType="TIMESTAMP" property="updateDatetime" />
  </resultMap>
  <sql id="Base_Column_List">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    user_id, company_id, with_authority, email, password, name, name_kana, department, 
    phone_no, fax, delete_flag, create_user, create_datetime, update_user, update_datetime
  </sql>
  <select id="selectByPrimaryKey" parameterType="java.lang.Integer" resultMap="BaseResultMap">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    select 
    <include refid="Base_Column_List" />
    from comp_user
    where user_id = #{userId,jdbcType=INTEGER}
  </select>
  <delete id="deleteByPrimaryKey" parameterType="java.lang.Integer">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    delete from comp_user
    where user_id = #{userId,jdbcType=INTEGER}
  </delete>
  <insert id="insert" parameterType="com.jp.sense.pr.model.entity.CompUser">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    insert into comp_user (user_id, company_id, with_authority, 
      email, password, name, 
      name_kana, department, phone_no, 
      fax, delete_flag, create_user, 
      create_datetime, update_user, update_datetime
      )
    values (#{userId,jdbcType=INTEGER}, #{companyId,jdbcType=INTEGER}, #{withAuthority,jdbcType=VARCHAR}, 
      #{email,jdbcType=VARCHAR}, #{password,jdbcType=VARCHAR}, #{name,jdbcType=VARCHAR}, 
      #{nameKana,jdbcType=VARCHAR}, #{department,jdbcType=VARCHAR}, #{phoneNo,jdbcType=VARCHAR}, 
      #{fax,jdbcType=VARCHAR}, #{deleteFlag,jdbcType=VARCHAR}, #{createUser,jdbcType=VARCHAR}, 
      #{createDatetime,jdbcType=TIMESTAMP}, #{updateUser,jdbcType=VARCHAR}, #{updateDatetime,jdbcType=TIMESTAMP}
      )
  </insert>
  <insert id="insertSelective" parameterType="com.jp.sense.pr.model.entity.CompUser">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    insert into comp_user
    <trim prefix="(" suffix=")" suffixOverrides=",">
      <if test="userId != null">
        user_id,
      </if>
      <if test="companyId != null">
        company_id,
      </if>
      <if test="withAuthority != null">
        with_authority,
      </if>
      <if test="email != null">
        email,
      </if>
      <if test="password != null">
        password,
      </if>
      <if test="name != null">
        name,
      </if>
      <if test="nameKana != null">
        name_kana,
      </if>
      <if test="department != null">
        department,
      </if>
      <if test="phoneNo != null">
        phone_no,
      </if>
      <if test="fax != null">
        fax,
      </if>
      <if test="deleteFlag != null">
        delete_flag,
      </if>
      <if test="createUser != null">
        create_user,
      </if>
      <if test="createDatetime != null">
        create_datetime,
      </if>
      <if test="updateUser != null">
        update_user,
      </if>
      <if test="updateDatetime != null">
        update_datetime,
      </if>
    </trim>
    <trim prefix="values (" suffix=")" suffixOverrides=",">
      <if test="userId != null">
        #{userId,jdbcType=INTEGER},
      </if>
      <if test="companyId != null">
        #{companyId,jdbcType=INTEGER},
      </if>
      <if test="withAuthority != null">
        #{withAuthority,jdbcType=VARCHAR},
      </if>
      <if test="email != null">
        #{email,jdbcType=VARCHAR},
      </if>
      <if test="password != null">
        #{password,jdbcType=VARCHAR},
      </if>
      <if test="name != null">
        #{name,jdbcType=VARCHAR},
      </if>
      <if test="nameKana != null">
        #{nameKana,jdbcType=VARCHAR},
      </if>
      <if test="department != null">
        #{department,jdbcType=VARCHAR},
      </if>
      <if test="phoneNo != null">
        #{phoneNo,jdbcType=VARCHAR},
      </if>
      <if test="fax != null">
        #{fax,jdbcType=VARCHAR},
      </if>
      <if test="deleteFlag != null">
        #{deleteFlag,jdbcType=VARCHAR},
      </if>
      <if test="createUser != null">
        #{createUser,jdbcType=VARCHAR},
      </if>
      <if test="createDatetime != null">
        #{createDatetime,jdbcType=TIMESTAMP},
      </if>
      <if test="updateUser != null">
        #{updateUser,jdbcType=VARCHAR},
      </if>
      <if test="updateDatetime != null">
        #{updateDatetime,jdbcType=TIMESTAMP},
      </if>
    </trim>
  </insert>
  <update id="updateByPrimaryKeySelective" parameterType="com.jp.sense.pr.model.entity.CompUser">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    update comp_user
    <set>
      <if test="companyId != null">
        company_id = #{companyId,jdbcType=INTEGER},
      </if>
      <if test="withAuthority != null">
        with_authority = #{withAuthority,jdbcType=VARCHAR},
      </if>
      <if test="email != null">
        email = #{email,jdbcType=VARCHAR},
      </if>
      <if test="password != null">
        password = #{password,jdbcType=VARCHAR},
      </if>
      <if test="name != null">
        name = #{name,jdbcType=VARCHAR},
      </if>
      <if test="nameKana != null">
        name_kana = #{nameKana,jdbcType=VARCHAR},
      </if>
      <if test="department != null">
        department = #{department,jdbcType=VARCHAR},
      </if>
      <if test="phoneNo != null">
        phone_no = #{phoneNo,jdbcType=VARCHAR},
      </if>
      <if test="fax != null">
        fax = #{fax,jdbcType=VARCHAR},
      </if>
      <if test="deleteFlag != null">
        delete_flag = #{deleteFlag,jdbcType=VARCHAR},
      </if>
      <if test="createUser != null">
        create_user = #{createUser,jdbcType=VARCHAR},
      </if>
      <if test="createDatetime != null">
        create_datetime = #{createDatetime,jdbcType=TIMESTAMP},
      </if>
      <if test="updateUser != null">
        update_user = #{updateUser,jdbcType=VARCHAR},
      </if>
      <if test="updateDatetime != null">
        update_datetime = #{updateDatetime,jdbcType=TIMESTAMP},
      </if>
    </set>
    where user_id = #{userId,jdbcType=INTEGER}
  </update>
  <update id="updateByPrimaryKey" parameterType="com.jp.sense.pr.model.entity.CompUser">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    update comp_user
    set company_id = #{companyId,jdbcType=INTEGER},
      with_authority = #{withAuthority,jdbcType=VARCHAR},
      email = #{email,jdbcType=VARCHAR},
      password = #{password,jdbcType=VARCHAR},
      name = #{name,jdbcType=VARCHAR},
      name_kana = #{nameKana,jdbcType=VARCHAR},
      department = #{department,jdbcType=VARCHAR},
      phone_no = #{phoneNo,jdbcType=VARCHAR},
      fax = #{fax,jdbcType=VARCHAR},
      delete_flag = #{deleteFlag,jdbcType=VARCHAR},
      create_user = #{createUser,jdbcType=VARCHAR},
      create_datetime = #{createDatetime,jdbcType=TIMESTAMP},
      update_user = #{updateUser,jdbcType=VARCHAR},
      update_datetime = #{updateDatetime,jdbcType=TIMESTAMP}
    where user_id = #{userId,jdbcType=INTEGER}
  </update>
  
  <!-- 認証用ユーザ取得関数 -->
  <select id="selectByEmail" parameterType="java.lang.String" resultMap="BaseResultMap">
    select 
    <include refid="Base_Column_List" />
    from comp_user
    where email = #{email,jdbcType=VARCHAR}
    AND delete_flag = '0'
  </select>
  
  <resultMap id="User_Comp_ResultMap" type="com.jp.sense.pr.model.entity.CompUser">
  	<!-- ユーザのProperty マッピング-->
    <id column="u_user_id" jdbcType="INTEGER" property="userId" />
    <result column="u_company_id" jdbcType="INTEGER" property="companyId" />
    <result column="u_with_authority" jdbcType="VARCHAR" property="withAuthority" />
    <result column="u_email" jdbcType="VARCHAR" property="email" />
    <result column="u_password" jdbcType="VARCHAR" property="password" />
    <result column="u_name" jdbcType="VARCHAR" property="name" />
    <result column="u_name_kana" jdbcType="VARCHAR" property="nameKana" />
    <result column="u_department" jdbcType="VARCHAR" property="department" />
    <result column="u_phone_no" jdbcType="VARCHAR" property="phoneNo" />
    <result column="u_fax" jdbcType="VARCHAR" property="fax" />
    <result column="u_delete_flag" jdbcType="VARCHAR" property="deleteFlag" />
    <result column="u_create_user" jdbcType="VARCHAR" property="createUser" />
    <result column="u_create_datetime" jdbcType="TIMESTAMP" property="createDatetime" />
    <result column="u_update_user" jdbcType="VARCHAR" property="updateUser" />
    <result column="u_update_datetime" jdbcType="TIMESTAMP" property="updateDatetime" />
    
    <!-- ユーザ企業のProperty マッピング-->
	<result column="c_id" property="company.id" />
	<result column="c_corporate_name" jdbcType="VARCHAR" property="company.corporateName" />
    <result column="c_corporate_name_kana" jdbcType="VARCHAR" property="company.corporateNameKana" />
    <result column="c_logo_path" jdbcType="VARCHAR" property="company.logoPath" />
	
	<!-- association: 企業オブジェクトProperty 定義 -->
	<association property="company" javaType="com.jp.sense.pr.model.entity.Company">
		<id column="id" jdbcType="INTEGER" property="id" />
	    <result column="corporate_name" jdbcType="VARCHAR" property="corporateName" />
	    <result column="corporate_name_kana" jdbcType="VARCHAR" property="corporateNameKana" />
	    <result column="representative_name" jdbcType="VARCHAR" property="representativeName" />
	    <result column="representative_position" jdbcType="VARCHAR" property="representativePosition" />
	    <result column="establishment_date" jdbcType="TIMESTAMP" property="establishmentDate" />
	    <result column="address1" jdbcType="VARCHAR" property="address1" />
	    <result column="address2" jdbcType="VARCHAR" property="address2" />
	    <result column="address3" jdbcType="VARCHAR" property="address3" />
	    <result column="representative_phone_no" jdbcType="VARCHAR" property="representativePhoneNo" />
	    <result column="listing_category" jdbcType="VARCHAR" property="listingCategory" />
	    <result column="security_code" jdbcType="VARCHAR" property="securityCode" />
	    <result column="capital_amount" jdbcType="VARCHAR" property="capitalAmount" />
	    <result column="num_of_employees" jdbcType="VARCHAR" property="numOfEmployees" />
	    <result column="site_url" jdbcType="VARCHAR" property="siteUrl" />
	    <result column="industry_category" jdbcType="INTEGER" property="industryCategory" />
	    <result column="company_category1" jdbcType="INTEGER" property="companyCategory1" />
	    <result column="company_category2" jdbcType="INTEGER" property="companyCategory2" />
	    <result column="company_category3" jdbcType="INTEGER" property="companyCategory3" />
	    <result column="company_plan_id" jdbcType="INTEGER" property="companyPlanId" />
	    <result column="plan_renewal_category" jdbcType="VARCHAR" property="planRenewalCategory" />
	    <result column="logo_path" jdbcType="VARCHAR" property="logoPath" />
	    <result column="is_displayed_cover_image" jdbcType="VARCHAR" property="isDisplayedCoverImage" />
	    <result column="delete_flag" jdbcType="VARCHAR" property="deleteFlag" />
	    <result column="create_user" jdbcType="VARCHAR" property="createUser" />
	    <result column="create_datetime" jdbcType="TIMESTAMP" property="createDatetime" />
	    <result column="update_user" jdbcType="VARCHAR" property="updateUser" />
	    <result column="update_datetime" jdbcType="TIMESTAMP" property="updateDatetime" />
	</association>
  </resultMap>
  
  <sql id="User_Comp_Column_List">
  	u.user_id AS u_user_id
    , u.company_id AS u_company_id
    , u.with_authority AS u_with_authority
    , u.email AS u_email
    , u.password AS u_password
    , u.name AS u_name
    , u.name_kana AS u_name_kana
    , u.department AS u_department
    , u.phone_no AS u_phone_no
    , u.fax AS u_fax
    , u.delete_flag AS u_delete_flag
    , u.create_user AS u_create_user
    , u.create_datetime AS u_create_datetime
    , u.update_user AS u_update_user
    , u.update_datetime AS u_update_datetime
    , c.id AS c_id
    , c.corporate_name AS c_corporate_name
    , c.corporate_name_kana AS c_corporate_name_kana
    , c.logo_path AS c_logo_path
    
  </sql>
  
  <!-- 認証用ユーザ取得関数（会社情報付き） -->
  <select id="selectByEmailWithCompany" parameterType="java.lang.String" resultMap="User_Comp_ResultMap">
    select 
    <include refid="User_Comp_Column_List" />
    FROM
        comp_user u
        LEFT OUTER JOIN company c
        ON (u.company_id = c.id
        AND c.delete_flag = '0')
    WHERE u.email = #{email,jdbcType=VARCHAR}
    AND u.delete_flag = '0'
    LIMIT 0,1
  </select>
  
  <!-- BY企業ID -->
  <select id="selectByCompanyId" parameterType="java.lang.Integer" resultMap="BaseResultMap">
    <!--
    -->
    select 
    <include refid="Base_Column_List" />
    from comp_user
    where company_id = #{company_id,jdbcType=INTEGER} AND
    delete_flag = '0'
  </select>
  
  <update id="updateDeleteFlag" parameterType="java.lang.Integer">
    <!-- 朱岩 -->
    update comp_user
    <set>
      <if test="deleteFlag != null">
        DELETE_FLAG = '1',
      </if>
    </set>
    where user_id = #{user_id,jdbcType=INTEGER}
  </update>

  <!-- =Nay= -->
  <update id="updatePassword" parameterType="java.lang.String">
    UPDATE comp_user
    <set>
      <if test="password != null">
        password = #{password,jdbcType=VARCHAR},
      </if>
    </set>
    WHERE user_id = #{user_id,jdbcType=INTEGER}
  </update>
  
  <!--企業ユーザーパスワード再設定 -->
   <update id="updateCompUserPassword">
    update comp_user
    SET password = #{resetPassword}
    WHERE user_id = #{id}
  </update>
  
</mapper>